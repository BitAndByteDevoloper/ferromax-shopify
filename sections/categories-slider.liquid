{% comment %}
  Archivo: sections/slider-categorias.liquid
  Sección: Slider de categorías con flechas (CSS separado)
{% endcomment %}

<section id="slider-categorias-{{ section.id }}" class="slider-categorias color-{{ section.settings.color_scheme }}">
  <div class="sc-header page-width">
    <h2 class="sc-title">{{ section.settings.heading | default: 'Categorías' }}</h2>

    {% if section.settings.view_all_label != blank and section.settings.view_all_link != blank %}
      <a class="sc-viewall link" href="{{ section.settings.view_all_link }}">{{ section.settings.view_all_label }}</a>
    {% endif %}
  </div>

  <div class="sc-wrap page-width">
    <button class="sc-arrow sc-prev" aria-label="Anterior" type="button">
      <span aria-hidden="true">&larr;</span>
    </button>

    <div class="sc-track" id="sc-track-{{ section.id }}">
      {% for block in section.blocks %}
        {% assign b = block.settings %}
        {% capture style_vars %}
          --sc-card-bg: {{ b.bg_color }};
          --sc-card-border-color: {{ b.border_color }};
          --sc-card-border-width: {{ b.border_width }}px;
          --sc-card-radius: {{ b.radius }}px;
          --sc-text-color: {{ b.text_color }};
          --sc-card-padding: {{ b.padding }}px;
        {% endcapture %}

        <a
          {{ block.shopify_attributes }}
          class="sc-card"
          href="{{ b.link | default: '#' }}"
          style="{{ style_vars | strip }}"
        >
          <div class="sc-media">
            {% if b.image != blank %}
              <img
                src="{{ b.image | image_url: width: 480 }}"
                alt="{{ b.title | escape }}"
                loading="lazy"
                width="{{ b.image.width }}"
                height="{{ b.image.height }}"
              >
            {% else %}
              <div class="sc-placeholder" aria-hidden="true"></div>
            {% endif %}
          </div>

          {% if b.title != blank %}
            <div class="sc-label">{{ b.title }}</div>
          {% endif %}
        </a>
      {% endfor %}
    </div>

    <button class="sc-arrow sc-next" aria-label="Siguiente" type="button">
      <span aria-hidden="true">&rarr;</span>
    </button>
  </div>

  <script>
    (function() {
      const section = document.getElementById('slider-categorias-{{ section.id }}');
      if (!section) return;

      const track = section.querySelector('#sc-track-{{ section.id }}');
      const prev  = section.querySelector('.sc-prev');
      const next  = section.querySelector('.sc-next');

      const cardWidth = () => {
        const card = track.querySelector('.sc-card');
        if (!card) return 300;
        const styles = getComputedStyle(card);
        return card.getBoundingClientRect().width
          + parseFloat(styles.marginLeft)
          + parseFloat(styles.marginRight);
      };

      const scrollByCards = (dir) => {
        const stepCards = {{ section.settings.scroll_cards | default: 3 }};
        track.scrollBy({ left: dir * stepCards * cardWidth(), behavior: 'smooth' });
      };

      prev && prev.addEventListener('click', () => scrollByCards(-1));
      next && next.addEventListener('click', () => scrollByCards(1));
    })();
  </script>
</section>

{% schema %}
{
  "name": "Slider Categorías",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Título", "default": "Categorías" },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Esquema de color",
      "options": [
        { "value": "background-1", "label": "Fondo 1" },
        { "value": "background-2", "label": "Fondo 2" },
        { "value": "inverse", "label": "Inverso" }
      ],
      "default": "background-1"
    },
    { "type": "text", "id": "view_all_label", "label": "Texto botón Ver todo", "default": "Ver todo" },
    { "type": "url", "id": "view_all_link", "label": "Enlace botón Ver todo" },
    {
      "type": "range",
      "id": "scroll_cards",
      "label": "Tarjetas a desplazar por clic",
      "min": 1, "max": 6, "step": 1, "default": 3
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Tarjeta de categoría",
      "settings": [
        { "type": "text", "id": "title", "label": "Título", "default": "Laptops" },
        { "type": "image_picker", "id": "image", "label": "Imagen" },
        { "type": "url", "id": "link", "label": "Enlace" },
        { "type": "color", "id": "bg_color", "label": "Fondo de la tarjeta", "default": "#EAF7E0" },
        { "type": "color", "id": "text_color", "label": "Color del texto", "default": "#1A1A1A" },
        {
          "type": "range",
          "id": "radius",
          "label": "Radio de borde (px)",
          "min": 0, "max": 32, "step": 1, "default": 16
        },
        { "type": "color", "id": "border_color", "label": "Color del borde", "default": "#E3E3E3" },
        {
          "type": "range",
          "id": "border_width",
          "label": "Grosor del borde (px)",
          "min": 0, "max": 4, "step": 1, "default": 1
        },
        {
          "type": "range",
          "id": "padding",
          "label": "Espaciado interno (px)",
          "min": 8, "max": 32, "step": 1, "default": 16
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Slider Categorías",
      "blocks": [
        { "type": "category", "settings": { "title": "Laptops" } },
        { "type": "category", "settings": { "title": "Audio" } },
        { "type": "category", "settings": { "title": "Computadoras" } }
      ]
    }
  ]
}
{% endschema %}
